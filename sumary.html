<!DOCTYPE html>
<html lang="sk">
<head>
  <meta charset="UTF-8">
  <title>Zhrnutie pohÄ¾adnice</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body {
      font-family: sans-serif;
      background: #f0f4f8;
      padding: 2em;
      text-align: center;
    }
    h1 {
      margin-bottom: 0.5em;
    }
    .preview-container {
      display: flex;
      justify-content: center;
      gap: 2em;
      flex-wrap: wrap;
      margin-bottom: 2em;
    }
    .preview-box img {
      max-width: 320px;
      border: 4px solid #ccc;
      box-shadow: 0 0 8px rgba(0,0,0,0.1);
    }
    .option-box {
      display: inline-block;
      background: white;
      padding: 1.5em;
      margin: 1em;
      border-radius: 10px;
      box-shadow: 0 0 8px rgba(0,0,0,0.1);
      width: 280px;
    }
    .option-box button {
      margin-top: 1em;
      padding: 0.5em 1em;
      font-size: 16px;
      background: #2277cc;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
  </style>
</head>
<body>

  <h1>âœ… PohÄ¾adnica pripravenÃ¡!</h1>
  <div class="preview-container">
    <div class="preview-box">
      <h3>PrednÃ¡ strana</h3>
      <img id="frontPreview" src="">
    </div>
    <div class="preview-box">
      <h3>ZadnÃ¡ strana</h3>
      <img id="backPreview" src="">
    </div>
  </div>

  <div class="option-box">
    <h2>ðŸ”— ZdieÄ¾aÅ¥ na Facebooku</h2>
    <button onclick="shareOnFacebook()">ZdieÄ¾aÅ¥ prednÃº stranu</button>
  </div>

  <div class="option-box">
    <h2>â¬‡ StiahnuÅ¥ pohÄ¾adnicu</h2>
    <button onclick="downloadOptions()">StiahnuÅ¥ (PNG / PDF)</button>
  </div>

  <div class="option-box">
    <h2>ðŸ’³ SimulovaÅ¥ odoslanie</h2>
    <button onclick="simulateSend()">SimulovaÅ¥ odoslanie</button>
  </div>

  <script>
    const CLOUD_NAME = "dqtev9r7m";
    const UPLOAD_PRESET = "unsigned_postcards";

    const frontData = localStorage.getItem("postcardImage");
    const backData = localStorage.getItem("postcardBack");

    if (frontData) document.getElementById("frontPreview").src = frontData;
    if (backData) document.getElementById("backPreview").src = backData;

    async function shareOnFacebook() {
      if (!frontData) return alert("ChÃ½ba prednÃ¡ strana.");

      const blob = await (await fetch(frontData)).blob();
      const formData = new FormData();
      formData.append("file", blob);
      formData.append("upload_preset", UPLOAD_PRESET);

      const response = await fetch(`https://api.cloudinary.com/v1_1/${CLOUD_NAME}/image/upload`, {
        method: "POST",
        body: formData
      });

      const json = await response.json();
      if (json.secure_url) {
        const fbUrl = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(json.secure_url)}`;
        window.open(fbUrl, "_blank", "width=600,height=400");
      } else {
        alert("ZdieÄ¾anie zlyhalo.");
      }
    }

    function downloadOptions() {
      const choice = prompt("ChceÅ¡ stiahnuÅ¥ PNG (len prednÃ¡) alebo PDF (obe strany)? NapÃ­Å¡: png alebo pdf");
      if (!choice) return;

      if (choice.toLowerCase() === "png") {
        downloadPNG();
      } else if (choice.toLowerCase() === "pdf") {
        downloadPDF();
      } else {
        alert("NeplatnÃ¡ voÄ¾ba.");
      }
    }

    function downloadPNG() {
      const link = document.createElement("a");
      link.download = "pohladnica.png";
      link.href = frontData;
      link.click();
    }

    async function downloadPDF() {
      if (!frontData || !backData) return alert("Obe strany musia byÅ¥ dostupnÃ©!");

      const { jsPDF } = window.jspdf;
      const pdf = new jsPDF({
        orientation: "landscape",
        unit: "mm",
        format: [148, 105] // A6 na Å¡Ã­rku
      });

      const front = await loadImage(frontData);
      const back = await loadImage(backData);

      pdf.addImage(front, "PNG", 0, 0, 148, 105);
      pdf.addPage();
      pdf.addImage(back, "PNG", 0, 0, 148, 105);

      pdf.save("pohladnica.pdf");
    }

    function loadImage(dataUrl) {
      return new Promise((resolve) => {
        const img = new Image();
        img.onload = () => resolve(img);
        img.src = dataUrl;
      });
    }

    function simulateSend() {
      alert("SimulÃ¡cia odoslania â€“ zatiaÄ¾ demo reÅ¾im.");
    }
  </script>
</body>
</html>
